<%- include('../partials/header', { title }) %>
<h1><%= title %></h1>
<form action="/purchases/add" method="post">
  <label>User <select name="userID" required><option value="">— Select user —</option>
    <% if (users && users.length) %>
    <% { users.forEach(u => { %> 
  <option value="<%= u.userID %>"><%= u.username %></option>

      <% });  %>
    <% } %>
    </select></label>
  <label>Game 
    <select id="gameSelect" name="gameID" required>
      <option value="">— Select game —</option>
    <% if (games && games.length) %> 
    <% { games.forEach(g => { %>

      <option 
        value="<%= g.gameID %>" 
        data-price="<%= g.price %>">
        <%= g.title %> ($<%= g.price %>)
      </option>

      <% }); %> 
    <% } %>
    </select></label>
  <label>Date & time <input type="datetime-local" name="purchaseDate" required /></label>
  <label>Price <input id="priceField" type="number" name="purchasePrice" step="0.01" min="0" required placeholder="0.00" /></label>
  <button type="submit">Add purchase</button>
</form>
<br>
<a href="/purchases" class="nav-btn">← Back to Purchases</a>

<script>
  const gameSelect = document.getElementById('gameSelect');
  const priceField = document.getElementById('priceField');

  gameSelect.addEventListener('change', () => {
    const selected = gameSelect.options[gameSelect.selectedIndex];
    priceField.value = selected.dataset.price || '';
  });
</script>

<%- include('../partials/footer') %>
